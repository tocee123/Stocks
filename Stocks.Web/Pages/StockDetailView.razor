@page "/stockdetail/{shortname}"
@using Stocks.Core.Models;
@using Stocks.Core;
@using System.Linq;
@inject IStocksRepository stockRepository;

@if (Stock is not null)
{
    <a href="/">Back</a>
    <h2>Details for @Stock.Name with short name @Stock.ShortName</h2>
    <h3>Price: @Stock.Price</h3>

    <h3>Dividend to price ratio: @Stock.DividendToPrice.ToPercentageDisplay()</h3>
    <h3>Dividend history</h3>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>ExDate</th>
                <th>RecordDate</th>
                <th>PayDate</th>
                <th>DeclarationDate</th>
                <th>WhenToBuy</th>
                <th>Type</th>
                <th>Dividend amount</th>
                <th>Dividend to price ratio</th>
            </tr>
            @foreach (var history in Stock.DividendHistories)
            {
                <tr>
                    <td>@history.ExDate.ToYyyyMmDd()</td>
                    <td>@history.RecordDate.ToYyyyMmDd()</td>
                    <td>@history.PayDate.ToYyyyMmDd()</td>
                    <td>@history.DeclarationDate.ToYyyyMmDd()</td>
                    <td>@history.WhenToBuy.ToYyyyMmDd()</td>
                    <td class="@GetTypeBackgroundColor(history.Type)">@history.Type</td>
                    <td>@history.Amount</td>
                    <td class="@Common.GetCssForDividendToPrice(history.Amount / Stock.Price)">@Common.ToPercentageDisplay(history.Amount / Stock.Price)</td>
                </tr>
            }
        </thead>
    </table>
}
@code
{
    [Parameter]
    public string shortname { get; set; }

    private StockDividend Stock { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var stocks = await stockRepository.GetStocks();
        Stock = stocks.Single(x => x.ShortName == shortname);
    }

    private string GetTypeBackgroundColor(string type)
        => type == "Special" ? "p-3 mb-2 bg-primary text-white" : "p-3 mb-2 bg-secondary text-white";
}